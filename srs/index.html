<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>SRS</title>
</head>
<body>
<script>
	const kanjiList =
		/*"一乙九七十人二入八力刀丁又了下口三山子女小上夕千川大土丸弓工才万士久干己寸亡及巾乞丈刃凡与円王火月犬五手" +
		"水中天日文木六引牛元戸午公今止少心切太内父分方毛友化区反予欠氏不夫支比仏尺収仁片牙介刈凶斤幻互勾孔升冗井双丹弔爪斗" +
		"屯匂匹乏厄右玉左四出正生石田白本目立外兄古広市矢台冬半母北用央去号皿仕写主申世他打代皮氷平由礼以加功札史司失必付辺" +
		"包末未民令圧永可刊旧句示犯布弁穴冊処庁幼凹瓦且甘丘巨玄巧甲込" +*/
		/*"𠮟" +*/
		/*"囚汁召尻斥仙占旦奴凸丼尼氾払丙矛気休糸字耳先早竹虫年" +
		"百名羽回会交光考行合寺自色西多地池当同肉米毎安曲血向死次式守州全有羊両列衣印各共好成争仲兆伝灯老因仮件再在舌団任宇" +
		"灰危机吸后至存宅扱芋汚汗缶企伎吉朽臼叫仰刑江旨芝朱舟充旬巡如匠尽迅壮吐弐肌伐帆汎妃伏忙朴妄吏劣花貝見車赤足村男町何" +
		"角汽近形言谷作社図声走体弟売麦来里医究局君決住助身対投豆坂返役位囲改完希求芸告材児初臣折束低努兵別利良冷労応快技均" +
		"災志似序条状判防余我系孝困私否批忘乱卵亜壱戒肝含岐忌却狂吟串迎呉坑抗攻更克佐沙伺寿秀床抄肖伸芯辛吹杉即汰妥択沢但沖" +
		"沈呈廷那尿妊忍把伯抜伴阪尾肘扶芳邦坊妨没妙冶妖抑沃励戻呂弄雨学金空青林画岩京国姉知長直店東歩妹明門夜委育泳岸苦具幸" +
		"使始事実者取受所昔注定波板表服物放味命油和英果芽官季泣協径固刷参治周松卒底的典毒念府法牧例易往価河居券効妻枝舎述招" +
		"承制性版肥非武延沿拡供呼刻若宗垂担宙忠届乳拝並宝枚宛依炎押旺欧殴岡佳苛怪拐劾岳玩奇祈宜拒拠享況屈茎肩弦股虎拘肯昆采" +
		"刹刺祉肢侍邪呪叔尚昇沼炊枢姓征斉析拙狙阻卓拓抽坪抵邸泥迭妬到突奈杯拍泊迫彼披泌苗怖阜附侮沸併奉抱泡房" +*/
		/*"肪" +*/
		/*"奔枕抹岬免茂" +
		"盲弥拉炉枠音草科海活計後思室首秋春食星前茶昼点南風屋界客急級係研県指持拾重昭乗神相送待炭柱追度畑発美秒品負面洋胃栄" +
		"紀軍型建昨祝信省浅単飛変便約勇要逆限故厚査政祖則退独保迷映革巻看皇紅砂姿城宣専泉洗染奏段派背肺律哀威為畏茨咽姻疫怨" +
		"卸架悔皆垣柿括冠軌虐糾峡挟狭契孤弧枯侯恒洪荒郊香拷恨砕削柵咲拶施狩臭柔俊盾叙浄拭侵津甚帥是牲窃荘促俗耐怠胎胆挑勅珍" +
		"亭貞帝訂怒逃洞峠栃虹卑眉訃赴封柄胞某冒勃盆" +*/
		/*"昧" +*/
		/*"幽柳侶厘郎校夏家記帰原高紙時弱書通馬員院荷起宮庫根酒消真息速庭島配倍病" +
		"勉流旅案害挙訓郡候航差殺残借笑席倉孫帯徒特梅粉脈浴料連益桜恩格個耕財師修素造能破俵容留株胸降骨座蚕射従純除将針値展" +
		"討党納俳班秘陛朗挨唄畝浦悦宴翁俺華蚊核釜陥既飢鬼恐恭脅恵桁倹兼剣拳軒娯悟貢剛唆挫宰栽剤索桟恣脂疾酌殊珠袖准殉徐宵症" +
		"祥称辱唇" +*/
		/*"娠" +*/
		/*"振浸陣粋衰凄逝脊隻扇栓租捜挿桑捉泰託恥致畜逐秩衷酎捗朕逓哲途倒凍唐桃透胴匿悩剝畔般疲被姫浜敏浮紛哺捕俸倣" +
		"峰砲剖紡埋眠娘冥" +*/
		"耗紋竜倫涙烈恋浪脇魚強教黄黒細週雪船組鳥野理悪球祭終習宿商章深進族第帳笛転都動部問貨械救健康菜産唱" +
		"清巣側停堂得敗票副望陸移液眼基寄規許経険現混採授術常情責接設率断張貧婦務略異域郷済視捨推盛窓探著頂脳閉訪密訳郵欲翌" +
		"尉萎逸淫陰菓崖涯殻郭掛喝渇乾勘患貫亀偽菊脚虚菌惧偶掘啓掲渓蛍舷控梗頃婚痕紺彩斎埼崎惨斬鹿執赦斜蛇釈寂羞渋淑粛庶渉紹" +
		"訟剰紳酔崇据惜戚旋措粗掃曹曽爽唾堆袋逮脱淡窒彫眺釣陳偵添悼盗陶豚貪梨軟捻粘婆排培陪舶販描猫瓶符偏崩堀麻猛唯悠庸粒隆" +
		"涼猟陵累森雲絵間場晴朝答道買番飲運温開階寒期軽湖港歯集暑勝植短着湯登等童悲筆遊葉陽落街覚喜給極景結最散順焼象然隊達" +
		"貯博飯費満無量営過賀検減証税絶測属貸提程統備評富復報貿割揮貴勤筋敬裁策詞就衆善創装尊痛晩補棒握嵐偉椅詠越媛援奥渦葛" +
		"喚堪換敢棺款閑幾棋欺喫距御暁琴遇隅圏堅雇喉慌硬絞項詐酢傘紫滋軸湿煮循掌晶焦硝粧詔畳殖診尋須遂随婿疎訴喪痩葬堕惰替棚" +
		"弾遅貼超椎塚堤渡塔搭棟痘筒鈍廃媒斑蛮扉普幅雰塀遍募傍帽喩愉湧猶裕雄揚揺絡痢硫塁裂廊惑湾腕園遠楽新数電話暗意感漢業詩" +
		"想鉄農福路愛塩試辞照節戦続置腸働解幹義禁群鉱罪資飼準勢損墓豊夢預絹源署傷蒸聖誠暖賃腹幕盟裏彙違煙猿鉛虞嫁暇禍靴雅塊" +
		"楷慨蓋該較隔滑褐勧寛頑棄毀詰嗅僅愚窟傾携継詣隙傑嫌献遣誇鼓碁溝傲債催塞歳載搾嗣慈嫉腫愁酬奨詳飾触寝慎腎睡裾跡摂煎羨" +
		"腺詮践禅塑僧賊滞滝嘆痴稚蓄跳艇溺塡殿塗督頓漠鉢搬煩頒微蜂飽睦滅誉溶腰裸雷酪慄虜鈴零廉賂楼賄歌語算読聞鳴駅銀鼻様緑練" +
		"管関旗漁察種静説歴演慣境構際雑酸精製銭総像増態適銅徳複綿領閣疑誤穀誌磁障層認暮模維隠寡箇概駆熊綱酵豪酷獄魂雌漆遮需" +
		"銃塾緒彰誓箋漸遡遭憎遜駄奪端綻嫡徴漬摘滴稲寧髪罰閥碑漂腐蔑慕貌僕墨膜慢漫蜜銘網誘瘍踊辣僚瑠暦漏線横談調箱億課器賞選" +
		"熱標養輪確潔賛質敵導編暴遺劇権熟諸蔵誕潮論慰影鋭謁閲縁稼餓潰潟歓監緩畿輝儀戯窮緊勲慶憬稽撃稿駒撮暫摯賜餌趣潤遵憧衝" +
		"縄嘱審震穂請潜遷槽踪諾誰鋳駐嘲澄墜締徹撤踏罵輩賠箸範盤罷膝賓敷膚賦舞噴墳憤幣弊蔽餅舗褒撲摩魅黙憂窯履璃慮寮霊親頭館" +
		"橋整薬機積録衛興築燃輸激憲鋼樹縦操糖奮緯憶穏壊懐諧骸獲憾還凝錦薫憩賢錮衡墾錯諮儒獣壌嬢錠薪醒薦膳濁壇緻諦賭篤曇濃薄" +
		"縛繁避壁縫膨謀頰磨麺諭融擁謡頼隣隷錬講謝績厳縮優覧曖臆嚇轄環擬犠矯謹謙鍵購懇擦爵醜償礁繊鮮燥霜戴濯鍛聴謄瞳謎鍋頻闇" +
		"翼療瞭齢顔曜題観験類額織職簡難臨穫顎鎌韓騎襟繭顕鎖瞬繕礎騒贈懲鎮藤闘藩覆璧癖翻癒濫藍糧願鏡識警臓韻艶繰鶏鯨璽蹴髄瀬" +
		"藻覇爆譜簿霧羅離麗麓議競護響懸鐘譲醸籍騰欄艦顧鶴魔躍露驚襲籠鑑鬱";

	let url = "https://jisho.org/api/v1/search/words?keyword=";
	async function getKanjiInfo(kanji) {
		let response = await fetch("https://cors-anywhere.herokuapp.com/" + url + kanji,
			{
				method: "GET",
				headers: new Headers({
					"Access-Control-Allow-Origin": "*",
					"Content-Type": "application/json",
				}),
				mode: "cors",
				cache: "no-cache"
			});
		let json = await response.json();
		return json.data;
	}

	var index = 0;
	function iteration() {
		getKanjiInfo(kanjiList.charAt(index)).then(data => {
			parseData(data);
			index ++;
			requestAnimationFrame(iteration);
		})
	}

	//for (let kanji of [..."露驚襲籠鑑"]) {

	function parseData(data) {
		let kanji = kanjiList.charAt(index);
		let bestSubdata = null;
		let bestVariant = null;
		let minKanjiCount = Number.MAX_VALUE;
		let minKanaCount = Number.MAX_VALUE;
		if (data == null || data.length === 0) {
			console.log(kanji + "> ???");
			document.write("<div>" + kanji + "</div>");
			return;
		}
		processSubdata: for (let subdata of data) {

			processVariant: for (let variant of subdata.japanese) {
				let word = variant.word;
				if (typeof word === "undefined" || word === null || word.indexOf(kanji) === -1) {
					//console.log(kanji + "> Not found at all: " + word);
					// console.log(subdata);
					continue;
				}
				// TODO Count non-JP-symbols?
				let kanjiCount = word.match(/[\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF]/g).length;
				let kanaCount = word.length - kanjiCount - 1;
				if (kanjiCount < minKanjiCount || (kanjiCount === minKanjiCount && kanaCount < minKanaCount)) {
					bestSubdata = subdata;
					bestVariant = variant;
					// console.log(kanji + "> Better: " + word);
					minKanaCount = kanaCount;
					minKanjiCount = kanjiCount;
				} else { // TODO If equal, collect more than 1 translation?
					// console.log(kanji + "> Not better: " + word);
				}
			}

		}
		console.log(kanji + "> Best found: " + bestVariant.word + " = " + bestVariant.reading);
		document.write("<div>" + kanji + " == " + bestVariant.word + " == " + bestVariant.reading + " == ");
		// TODO Configure slice parameters.
		bestSubdata.senses.slice(0, 2).forEach(s => {
			document.write(s.english_definitions.slice(0, 2).join(" | ") + " | ");
			console.log(s.english_definitions.slice(0, 2).join(" | "))
		});
		document.write("</div>");
//		console.log(bestSubdata);
	}

	iteration();
</script>
</body>
</html>